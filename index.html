<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="description" content="FSharp for Imperative.">
<meta name="keywords" content="f#, functional, imperative">
<title>A tourists guide to F#.</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6c818f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #444444; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #111111; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-weight: bold; font-style: normal; color: #465158; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #909ea7; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; color: #444444; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #748590; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #748590; }

blockquote, blockquote p { line-height: 1.5; color: #909ea7; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 0 #dddddd; }
table thead, table tfoot { background: none; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; text-align: left; }
table tr th, table tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: none; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.5; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.95em; font-style: normal !important; letter-spacing: 0; padding: 0; background-color: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; line-height: inherit; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.2; color: inherit; font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #333333; }

kbd { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; display: inline-block; color: black; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #373737; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #111111; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #748590; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #909ea7; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #909ea7; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #111111; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6c818f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: black; padding: 1.25em; }

#footer-text { color: white; line-height: 1.35; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #465158; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #3b444a; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #111111; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #748590; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 6px; border-radius: 6px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6c818f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 6px; border-radius: 6px; word-wrap: break-word; padding: 0.5em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: inherit; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.5em; -webkit-border-radius: 6px; border-radius: 6px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.2; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #909ea7; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6c818f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #748590; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #909ea7; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #748590; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 0; }

table.frame-sides { border-width: 0 0; }

table.frame-topbot { border-width: 0 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.5; background: none; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #333333; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h4 { color: #6c818f; }

.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 6px; border-radius: 6px; margin-left: 2em; margin-right: 2em; }

.admonitionblock { margin-left: 2em; margin-right: 2em; }
.admonitionblock > table { border: 1px solid #609060; border-top-width: 1.5em; background-color: #e9ffe9; border-collapse: separate; -webkit-border-radius: 0; border-radius: 0; }
.admonitionblock > table td.icon { padding-top: .5em; padding-bottom: .5em; }
.admonitionblock > table td.content { padding: .5em 1em; color: black; font-size: .9em; border-left: none; }

.sidebarblock { background-color: #e8ecef; border-color: #ccc; }
.sidebarblock > .content > .title { color: #444444; }

table.tableblock.grid-all { border-collapse: collapse; -webkit-border-radius: 0; border-radius: 0; }
table.tableblock.grid-all th.tableblock, table.tableblock.grid-all td.tableblock { border-bottom: 1px solid #aaa; }

#footer { background-color: #465158; padding: 2em; }

#footer-text { color: #eee; font-size: 0.8em; text-align: center; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="book">
<div id="header">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_a_tourists_guide_to_f">A tourists guide to F#.</a>
<ul class="sectlevel1">
<li><a href="#_is_functional_programming_hard">Is functional programming hard?</a></li>
<li><a href="#_f_interactive">F# Interactive</a>
<ul class="sectlevel2">
<li><a href="#_how_do_i_start_the_interactive_mode">How do I start the interactive mode?</a></li>
<li><a href="#_how_do_i_quit_interactive_mode">How do I quit interactive mode?</a></li>
<li><a href="#_how_do_i_write_to_the_console">How do I write to the console?</a></li>
</ul>
</li>
<li><a href="#_formatting">Formatting</a>
<ul class="sectlevel2">
<li><a href="#_is_whitespace_significant">Is whitespace significant?</a></li>
<li><a href="#_how_does_indentation_scope_things_in_f">How does indentation scope things in F#?</a></li>
<li><a href="#_what_the_hell_is_offsides">What the hell is offsides?</a></li>
</ul>
</li>
<li><a href="#_how_do_i_resolve_type_mismatch_errors">How do I resolve type mismatch errors?</a></li>
<li><a href="#_concepts">Concepts</a>
<ul class="sectlevel2">
<li><a href="#_why_are_variables_immutable_by_default">Why are variables immutable by default?</a></li>
</ul>
</li>
<li><a href="#_functions">Functions</a>
<ul class="sectlevel2">
<li><a href="#_functions_unit_values_and_side_effect">Functions, unit values and side-effect.</a></li>
<li><a href="#_returning_values">Returning values</a></li>
</ul>
</li>
<li><a href="#_recursion_versus_iteration">Recursion versus Iteration</a>
<ul class="sectlevel2">
<li><a href="#_tail_calls">Tail calls</a></li>
<li><a href="#_fold">Fold</a></li>
</ul>
</li>
<li><a href="#_types">Types</a>
<ul class="sectlevel2">
<li><a href="#_type_inference">Type Inference</a></li>
<li><a href="#_unit">Unit</a></li>
<li><a href="#_discriminated_unions">Discriminated Unions</a></li>
<li><a href="#_records">Records</a></li>
<li><a href="#_tuples">Tuples</a></li>
<li><a href="#_option_and_result">Option and Result</a></li>
<li><a href="#_structural_equality">Structural equality</a></li>
<li><a href="#_side_effects">Side-effects</a></li>
</ul>
</li>
<li><a href="#_assignment">Assignment</a></li>
<li><a href="#_asynchronous_programming">Asynchronous programming</a>
<ul class="sectlevel2">
<li><a href="#_problem">Problem</a></li>
<li><a href="#_a_basic_example">A basic example</a></li>
</ul>
</li>
<li><a href="#_generics">Generics</a>
<ul class="sectlevel2">
<li><a href="#_how_do_statically_resolved_type_parameters_work">How do statically resolved type parameters work?</a></li>
</ul>
</li>
<li><a href="#_how_to_replace_objects_with_closures">How to replace objects with closures</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
"I call it my billion-dollar mistake.
</blockquote>
<div class="attribution">
&#8212; Tony Hoare on null references<br>
<cite><a href="https://en.wikipedia.org/wiki/Tony_Hoare" class="bare">https://en.wikipedia.org/wiki/Tony_Hoare</a></cite>
</div>
</div>
<div class="quoteblock">
<blockquote>
"From the outset, F# placed non-nullness as central to its design: the value “null” can’t normally
be used in conjunction with F#-declared types, and in practice null-reference exceptions are rare."
</blockquote>
<div class="attribution">
&#8212; Don Syme<br>
<cite><a href="https://fsharp.org/history/hopl-final/hopl-fsharp.pdf">The Early History of F#</a></cite>
</div>
</div>
</div>
</div>
<h1 id="_a_tourists_guide_to_f" class="sect0">A tourists guide to F#.</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Thinking about using F# but don&#8217;t know where to start? Already know another programming langauge and
want to learn how to use a functional langauge? This document will guide you by showing the things
that I had to overcome when learning functional programming. Some of the idioms were new to me and
coming from an imperative programming langauge background, mainly C and C+\+, there were imperative
patterns I&#8217;d learnt that, although you use an imperative object oriented style with F#, you&#8217;re
missing out on the benefits of adopting a functional approach. After all what&#8217;s the point of
choosing to write programs in a functional programming and then not using funtional idioms.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_is_functional_programming_hard">Is functional programming hard?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Personally, what I found hard was hard unlearning certain idioms I&#8217;d picked up when using imperative
langauges. For example immutabality is a core component of functional programming, and learning how
to program by transforming data and not mutating it is key to benefiting from the logical safety of
a functional language. The hard part is unlearning old habits and forming new ones. For example when
looping over a data structure in an imperative language there is only really one way to do it and
the code in the loop that you write is unconstrained. It can do anything to the data. F# provides
higher order functions to deal with common patterns when iterating over data. But we&#8217;ll get to that
later. First steps are the mechanics that will get you up and running a program in F#.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_f_interactive">F# Interactive</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_do_i_start_the_interactive_mode">How do I start the interactive mode?</h3>
<div class="paragraph">
<p>There is a <code>F#</code> interpreter you can use interactively.
You can start it from the command line like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">dotnet fsi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then type your expression and end it with a double semi-colon for the expression evaluation to kick in.
The double semi-colon is inherited from ML, the language <code>F#</code> is derived from.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">dotnet fsi

Microsoft (R) `F#` Interactive version 11.4.2.0 for `F#` 5.0
Copyright (c) Microsoft Corporation. All Rights Reserved.

For help type #help;;

&gt; let x = 1
- let y = 3;;
val x : int = 1
val y : int = 3

&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when using the compiler you don&#8217;t need the double semi-colon to end an expression.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_do_i_quit_interactive_mode">How do I quit interactive mode?</h3>
<div class="paragraph">
<p>It&#8217;s easier than Vim</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#quit;;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_do_i_write_to_the_console">How do I write to the console?</h3>
<div class="paragraph">
<p>Writing to the console we can use <code>printfn</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">printfn "%s" "hello";;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Format specifiers are similar to the ones in <code>C</code>, except <code>%A</code> which renders any
type.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_formatting">Formatting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_is_whitespace_significant">Is whitespace significant?</h3>
<div class="paragraph">
<p><code>F#</code> is whitespace and indentation sensitive.
The guide to formatting is <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/formatting">here</a>.
In summary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use spaces not tabs.</p>
</li>
<li>
<p>4 spaces is prefered.</p>
</li>
<li>
<p>You can use <a href="https://github.com/fsprojects/fantomas/#fantomas">Fantomas</a> to format code.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_indentation_scope_things_in_f">How does indentation scope things in F#?</h3>
<div class="paragraph">
<p>This can be confusing for people coming from a language where indentation isn&#8217;t significant.
For example, the following two programs have different behaviours.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">open System

[&lt;EntryPoint&gt;]
let main argv =
    let foo () =
        printfn "foo"
        printfn "something"
    foo ()
    0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">foo
something</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">open System

[&lt;EntryPoint&gt;]
let main argv =
    let foo () =
        printfn "foo"
    printfn "something"
    foo ()
    0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">something
foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Identation is used to create expression blocks.
There is a mode the compiler can run in called verbose mode that is more compatible with OCaml syntax where expression blocks are explicitly delimited with <code>begin</code> and <code>end</code> keywords, but it&#8217;s rarely used in practice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_the_hell_is_offsides">What the hell is offsides?</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The following explanation is a simplification of the rule.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The 'offside' rule determines the column infront of which no other tokens are allowed.
The first character after an <code>=</code> marks the column that subsequent expressions have to start at.
It&#8217;s best illustrated with an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">open System

[&lt;EntryPoint&gt;]
let main argv =
    printfn "main" // p is the first character after =. It determines the offsides column
  let x = 1 // Compiler error at this line
  0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/home/sashan/code/tests/test/Program.fs(8,3): error FS0010: Unexpected keyword 'let' or 'use' in binding. Expected incomplete structured construct at or before this point or other token. [/home/sashan/code/tests/test/test.fsproj]
/home/sashan/code/tests/test/Program.fs(6,1): error FS3118: Incomplete value or function definition. If this is in an expression, the body of the expression must be indented to the same column as the 'let' keyword. [/home/sashan/code/tests/test/test.fsproj]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example that doesn&#8217;t compile. The line <code>printfn "something"</code> does not start in the same column as the the
first character after the equals.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let foo () = printfn "foo"
    printfn "something" //this won't compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corrected version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let foo () = printfn "foo"
             printfn "something" //now this compiles</code></pre>
</div>
</div>
<div class="paragraph">
<p>However it&#8217;s better to write it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let foo () =
    printfn "foo"
    printfn "something" //now this compiles</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_do_i_resolve_type_mismatch_errors">How do I resolve type mismatch errors?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is probably the most common error you will get when trying to get your F# code to compile.
Let&#8217;s have a look at the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; let foo x =
-     x + 2.0;;
val foo : x:float -&gt; float

&gt; foo 1;;

  foo 1;;
  ----^

/home/sashan/code/articles/fsharp-for-imperative/stdin(3,5): error FS0001: This expression was expected to have type
    'float'
but here has type
    'int'

&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s going on here? The compiler parses the function <code>foo</code> and infers the type of the argument to be a <code>float</code> because the type of the expression <code>x + 2.0</code> is inferred to be a <code>float</code> because the type of <code>2.0</code> is float.
Effectively the compiler recurses through the expressions to find a terminal type to infer the type of the non-terminal expressions.
You can do a similar thing, and pretend to be the compiler and recurse until you find a terminal type.
Let&#8217;s look at a more complicated example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">type R1 = {
    Name : string
    Age : int
    Email : string
}

type R2 = {
    Name : string
    Email : string
}

let printName x =
    let {R1.Name = name} = x
    printfn "%s" name

let x = {Name = "bob";Email="bob@somewhere.com"}

printName x</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we get the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Error: input.fsx (18,11)-(18,12) typecheck error This expression was expected to have type
    'R1'
but here has type
    'R2'</pre>
</div>
</div>
<div class="paragraph">
<p>at the line <code>printName x</code>. Clearly here it has resolved <code>x</code> to be of type <code>R2</code>, however in the function definition we match on <code>R1</code> when destructuring the value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">Concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_why_are_variables_immutable_by_default">Why are variables immutable by default?</h3>
<div class="paragraph">
<p>This will probably be a mind expanding experience for those familiar with normal languages.
It makes programming in a functional language harder, harder because you can&#8217;t just reach out and change the state of a variable.
In general you have to take the old value as input to function, use the function to transform the value, and return a new value.
If this seems like pointless effort, well you&#8217;re half right. Effort - yes. Pointless - no.
Immutability makes it easier to reason about program correctness.
Programs that manipulate shared mutable variables require access to that state to be locked. This opens to the door to other problems such as deadlocks and race conditions. The tradeoff is that performance traditionally is improved by the use of shared state, whereas immutability often implies copying of data, which incurs a performance cost.
For example the properties of REST, i.e. stateless and idempotent, naturally emerge if the code you write is immutable.
Since correctness and robustness of programs was a core design property of F#, immutability became a property of the language.
That said, because F# is also pragmatic and needs to operate with .NET which is imperative, there is support for mutable variables in the language.
However, if you write your programs maximising the use of immutable variables, it will synchronize well with the rest of the F# ecosystem, and makes programming using the language easy. There are some edge cases where this doesn&#8217;t apply, task expressions being one of them.</p>
</div>
<div class="listingblock">
<div class="title">F#</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let x = 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>is similar to</p>
</div>
<div class="listingblock">
<div class="title">c++</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">const int x = 1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We say that <code>x</code> is bound to a value, and the construct is called a <code>let
binding</code>. We don&#8217;t use the term <code>assigned</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functions">Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We don&#8217;t call functions.
We say we <code>apply a function</code>, or a <code>function is applied</code>.
<em>So how do I apply a function?</em>
You have to give it an argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let saySomething something = printfn "I say %s" something
...
saySomething "hello"</code></pre>
</div>
</div>
<div class="paragraph">
<p>We don&#8217;t use parantheses to apply functions.
Instead we pass in the next argument.
<em>But wait, I&#8217;ve seen cases where parantheses are used to call functions. What&#8217;s going on?</em>
Sometimes that&#8217;s a tuple or the unit value.</p>
</div>
<div class="sect2">
<h3 id="_functions_unit_values_and_side_effect">Functions, unit values and side-effect.</h3>
<div class="paragraph">
<p>There is a difference between binding a name to a value and a name to a function.</p>
</div>
<div class="paragraph">
<p>For example, in the following code, the value <code>1</code> is bound to <code>x</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let x = 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>A value is only ever evaluated once.
This can be seen in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">&gt; let tothemoon = printfn "to the moon";;
to the moon
val tothemoon : unit = ()

&gt; tothemoon;;
val it : unit = ()

&gt; tothemoon;;
val it : unit = ()

&gt; tothemoon;;
val it : unit = ()

&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>So what&#8217;s going on? <code>F#</code> realises that the <code>printfn</code> returns <code>unit</code>, evalutes the expression, and binds the resultant value to the indentifier <code>tothemoon</code>.
Remember, <code>F#</code> is a functional language and thinks that a function given the same input should return output that&#8217;s the same.
In this case, <code>tothemoon</code> takes no input arguments, therefore its value should never change.
If its value is never changing, there&#8217;s no need to evaluate it more than once.
And this is the chain of logic <code>F#</code> is following, which is why we don&#8217;t see multiple lines of "to the moon" in the console.
<em>So how can we change this, because I want the side-effect to happen?</em>
We pass an argument to the function.
It can be any other value or another function.
In this case we will pass the unit value to the function.
The unit value is a special value of type unit.
It simply acts as a space filler, a do nothing argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">&gt; let tothemoon () = printfn "to the moon";;
val tothemoon : unit -&gt; unit

&gt; tothemoon ();;
to the moon
val it : unit = ()

&gt; tothemoon ();;
to the moon
val it : unit = ()

&gt; tothemoon ();;
to the moon
val it : unit = ()</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Ok, but that still doesn&#8217;t make sense. The argument is always the same value, so shouldn&#8217;t it only be evaluated once?</em>
I asked the <a href="https://stackoverflow.com/questions/69997578/whats-the-theoretical-loophole-that-allows-f-or-any-functional-language-to-a/69999798#69999798">question on StackOverflow</a>.
Basically <code>F#</code> makes no distinction between pure and impure functions therefore the compiler cannot memoize the function, so it can&#8217;t remember that the previous result of a call to that function with a specific argument.</p>
</div>
</div>
<div class="sect2">
<h3 id="_returning_values">Returning values</h3>
<div class="paragraph">
<p>Everything is an expression so write the expression your function evaluates to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let add x y = x + y
...
add (mult 2 3) 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the placement of parentheses.
They encompass the first expression.
You have to do this since whitespace delimits arguments, so if the argument itself is an expression, then you need to use parantheses to group it, and tell the compiler that the expression is a single argument.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recursion_versus_iteration">Recursion versus Iteration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A fundamental difference between recursion and iteration is that the recursive one requires no mutable variables.
Therefore a guideline when to use recursion is when immutability provides a benefit, for example, in concurrent programming.
The downside of recursion, is that it consumes stack space and recursing too deeply will eventually cause a stack overflow.
There are ways to get around it using <code>fold</code> and/or <code>tail recursion</code>.</p>
</div>
<div class="listingblock">
<div class="title">Recursive factorial in F#</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let rec fac x =
  match x with
  | 0 -&gt; 1
  | _ -&gt; x * fac (x - 1)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Iterative factorial</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp++ hljs" data-lang="fsharp++">let fac x =
    let mutable state = 1
    for i in 1 .. x do
        state &lt;- state * i
    state</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_tail_calls">Tail calls</h3>
<div class="paragraph">
<p>Tail calls are a way to overcome the stackoverflow problem when using
recurison. When writing a recursive function try to make it tail recursive.
Typically a recursive function will store the state of the previous call to that function on the stack.
This consumes memory on the stack and after time will result in a stack overflow error depending on how deep the recursion goes and the stack size.
Recursive functions that are tail recursive eliminate the need for the result to be stored on the stack.</p>
</div>
<div class="paragraph">
<p><em>What is tail recursion?</em> It means the final thing that the function does is is the recursive
function itself.</p>
</div>
<div class="paragraph">
<p>Note that the factorial function above is not tail recursive.
The last thing that function does is multiply 2 values.
The example below shows a tail recursive function. It prints the elements in the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let rec tailf l =
    match l with
    | [] -&gt; ()
    | x::xs -&gt;
        printfn "%A" x
        tailf xs</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>How do we convert a recursive function into a
tail recursive function?</em> We thread an accumulator parameter through the
function.</p>
</div>
<div class="paragraph">
<p>For example, in the following factorial function, the function <code>helper</code> uses an accumulator parameter and is tail recursive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let fac x =
  let rec helper x acc =
    match x with
    | 0 -&gt; acc
    | _ -&gt; helper (x - 1) (x * acc)
  helper x 1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fold">Fold</h3>
<div class="paragraph">
<p>Fold is an extension of the accumulator idea shown above. The modules list, seq and array all have <code>fold</code> functions in them.</p>
</div>
<div class="paragraph">
<p>The following example shows how one can sum the elements using a fold.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let l = [1;2;3]
List.fold (fun acc x -&gt; x + acc) 0 l</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first parameter to <code>fold</code> is the function that operates on the accumulated value (state). It&#8217;s a function of 2 parameters that takes the accumulator and an element from the list. The accumulator is used to thread the value between calls to the function. The second parameter is the initial value of the accumulator. In this case, because we want to sum the elements, we set it to 0.
Internally <code>fold</code> uses a for loop and a mutable state variable, which means it&#8217;s safe from stack overflow.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types">Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>F#</code> loves types.
Working with types is easy in <code>F#</code> and you&#8217;ll get the most out of
the language in terms of correctness if you use them liberally.
They will save you writing trivial unit tests, so you can focus on the unit tests that
matter.
You&#8217;ll be surprised when your program runs correctly for the first time.</p>
</div>
<div class="paragraph">
<p>Personally, I think of programming in <code>F#</code> as programming in with shapes.
The shapes are the types you define, and the functions morph the shapes.
Along the way you fill in the shapes with untyped data, bringing type information to what was previously untyped, and safely transform the typed data with your functions.
<code>F#</code> has enough power to peel apart these shapes, via pattern matching, and recombine them easily.</p>
</div>
<div class="sect2">
<h3 id="_type_inference">Type Inference</h3>
<div class="paragraph">
<p>You&#8217;ll notice that the examples don&#8217;t follow the pattern of defining a variable
by its type and then initialising it. This is because <code>F#</code> uses type inference to
figure out what the type of the value is. This can take some getting used to,
and the compiler errors can cause some frustration, but it comes with practice,
and it&#8217;s easier than dealing with <code>C++</code> template errors.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unit">Unit</h3>
<div class="paragraph">
<p>Unit type is special. It&#8217;s like <code>void</code> in <code>C++</code> but it&#8217;s a proper type and has a literal symbol <code>()</code> that represents it.
If you want your expression to evaluate to nothing, then end it with <code>()</code>.
It&#8217;s often used in contexts where imperative langauges are the norm, like the .NET classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let foo () =
  bar param1
  ()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_discriminated_unions">Discriminated Unions</h3>
<div class="paragraph">
<p>These are so simple yet so powerful.
At first glance they might look like an <code>enum</code> or a <code>union</code> in <code>C++</code> but they are very different.
They can be used to represent enumerations but they can scale to represent other things as well.
They are unions, like unions in <code>C</code>, in the sense that only one of them is valid at the same time.
But where a union in <code>C</code> is more like syntactic sugar for representing the underlying memory, discriminated unions form a set of from which a variable of that type can only take on one value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">type Fruit =
  | Apple
  | Orange
  | Pear</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fruit names, <code>Apple</code> <code>Orange</code> and <code>Pear</code>, are called <code>constructors</code>.
They are used to construct the type <code>Fruit</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let fruit = Apple</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we know the type of <code>fruit</code> we know that it can only be one of the constructors in the set defined by the DU <code>Fruit</code>.
This gives the compiler more information to work.
DU&#8217;s go hand in hand with pattern matching and match expressions, so I&#8217;ll show an example here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let fruitName fruit =
  match fruit with
  | Apple -&gt; "apple"
  | Orange -&gt; "orange"
  | Pear -&gt; "pear"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The compiler can make use of the knowledge about <code>Fruit</code>.
If for example a match clause is missed, like <code>Pear</code> above, the compiler will warn you that you&#8217;ve missed a case.
This extends even deeper and works with pattern matched clauses as well. It&#8217;s not simply a literal <code>oh I&#8217;m missing a Pear from my
match statement therefore I must warn</code> algorithm.</p>
</div>
<div class="paragraph">
<p>A DU can be defined in terms of other types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">type Fruit =
  | Apple of string
  | Orange of string
  | Pear of string</code></pre>
</div>
</div>
<div class="paragraph">
<p>And can be created using the <code>constructor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let a = Apple "apple"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The type of <code>a</code> is <code>Fruit</code> and not <code>Apple</code>. <code>Fruit</code> has a set of constructors of which <code>Apple</code> is one.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_records">Records</h3>
<div class="paragraph">
<p>A record is like a struct in <code>C++</code>.
It can contain multiple distinct named types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">type User =
    { FirstName : string
      LastName : string
      Email : string }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can create a record simply by writing its inner names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let initUser first last email =
  {FirstName = first; LastName = last; Email = email}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is a name clash you can use the fully qualified name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let initUser first last email =
  {User.FirstName = first; User.LastName = last; User.Email = email}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Matching a record can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">match user with
| {Firstname = "sashan"} -&gt; printfn "alive"
| _ -&gt; printfn "unknown"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><em></code> means _I don&#8217;t care</em> about that value. It matches anything.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tuples">Tuples</h3>
<div class="paragraph">
<p>A tuple can contain multiple unamed distinct types.</p>
</div>
</div>
<div class="sect2">
<h3 id="_option_and_result">Option and Result</h3>
<div class="paragraph">
<p>Use this type instead of sentinel value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_structural_equality">Structural equality</h3>
<div class="paragraph">
<p><code>F#</code> has structural equality.
All types can be compared for equality without writing a comparison object, as you might have to do in <code>C#</code>
Additionally, because there are no nulls in the language, one doesn&#8217;t have to write code to check for that invariant.</p>
</div>
</div>
<div class="sect2">
<h3 id="_side_effects">Side-effects</h3>
<div class="paragraph">
<p>Understand what a side-effect is.
It&#8217;s not the same as a medical side-effect, which is bad and unintended. Intentionallity has nothing to do with it.
In computer science the term side-effect has a different meaning from colloquial usage.
Understand it from the perspective of the function.
If a function returns a value and changes the state of another entity in the process of calculating that value to return, then it has a side-effect.
For example the function could change a database. The change to the database is a side-effect.
It happens as a side-effect of applying that function.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_assignment">Assignment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although we want to write code immutably, there will be times you will need assign values, especially when working with the .NET classes.
To create a mutable value (a variable) we use the <code>mutable</code> keyword and use <code>&#8592;</code> for assignment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let mutable x = 1

x &lt;- 2</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asynchronous_programming">Asynchronous programming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of <code>F#'s</code> core features is a model for asynchronous programming.
Since then other languages have added support for asynchronous programming, in various ways.
<code>F#</code> added it to the language based on an underlying extensible feature called <em>computation expressions</em>.
Computation expressions essentially allow one to define a monadic type.
However, all of this is already getting too academic, and detracting from the core of what I want to show, that is how to use <code>async expressions</code>.</p>
</div>
<div class="sect2">
<h3 id="_problem">Problem</h3>
<div class="paragraph">
<p>The problem that <code>async</code> solves are the problems associated with callback funtions.
In <code>C</code>, for example, say you wanted to read from the console. One way to do it would be to call a function that waits for the input from the user.
This is synchronous programming.
Control flow is paused and the thread waits for the operating system to tell it when the data is available to return to the user.
Another way is to register a callback function. This function is called back by the operating system when data is available.
This allows asynchronousity at the expense of cohesion.
Control flow is inverted which makes it hard to trace through the logic of the code as a human who has to understand it.
Additonally one must think about how to share variables between the callback function and the main flow of the program.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_basic_example">A basic example</h3>
<div class="paragraph">
<p>Here&#8217;s an example of a request to get a webpage. In this case I haven&#8217;t handled the async call <code>GetAsync</code> properly and if run the code will exit before the value from the async is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">open System.Net.Http

let get () =
    let uri = "http://www.contoso.com"
    use client = new HttpClient()
    let response = client.GetAsync(uri)
    printfn "%A" response

get ()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now I&#8217;m going to handle the async call with a 'callback' that prints the response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">open System.Net.Http

let get = async {
    let uri = "http://www.contoso.com"
    use client = new HttpClient()
    let! response = client.GetAsync(uri) |&gt; Async.AwaitTask
    // here onwards is the callback
    printfn "%A" response
}
get |&gt; Async.RunSynchronously</code></pre>
</div>
</div>
<div class="paragraph">
<p>There you go. That&#8217;s it. The callback is really the stuff at the printfn line and beyond.
This will look like magic to <code>C/C++</code> programmers. When I learned <code>F#</code> around 2010 it looked like magic to me.
In fact it was mind-blowing. Now I could handle the same variable in scope and flow of control wasn&#8217;t inverted.
Now it&#8217;s 2022 and a lot of languages have caught onto this paradigm and have some way to do asynchronous programming.
Probably the most famous of these is <code>Go</code>. <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="paragraph">
<p>Let&#8217;s explain what&#8217;s going on here.
The <code>async { &#8230;&#8203; }</code> block is a <em>computation expression</em>. Don&#8217;t worry about what that is for now, just know that it&#8217;s another feature of the the language and you can define your own computation expressions.
However, computation expressions open the door to <code>let!</code> and other keywords that are suffixed with a <code>!</code>.
What does that <code>!</code> mean?
It means <code>await</code> the result of the expression and in the case of <code>let!</code> bind it to the name given.
What is being waited on (awaited)? We need something that is <code>Async&lt;'u&gt;</code> to await. However the return type of GetAsync is a <code>Task&lt;'u&gt;</code> object. When interoperating with .NET libraries you&#8217;ll find that most of them return <code>Task</code>.
Now we have to convert this task to an <code>Async&lt;'u&gt;</code> and that&#8217;s what <code>Async.AwaitTask</code> lets us do.
Now we can await the result and bind it using <code>let! response =&#8230;&#8203;</code>. You can think of <code>let!</code> as a way to unwrap the type and get at what is inside <code>Async</code>. Thus, <code>response</code> becomes a value of type <code>'u</code>.</p>
</div>
<div class="paragraph">
<p>Finally we have the line <code>get |&gt; Async.RunSynchronously</code>. It takes an async block and runs it.
If we don&#8217;t pass the block to <code>RunSynchronously</code> it won&#8217;t run.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generics">Generics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_do_statically_resolved_type_parameters_work">How do statically resolved type parameters work?</h3>
<div class="paragraph">
<p>Statically resolved type parameters are used to constrain types passed to functions.
They&#8217;re a way to specify that a parameter to a function should support certain members if it is to be used within that function.
It does this by allowing you to specify constraints for that parameter, for example, the specific function that the parameter should have.
You can say <em>oh this function only works with types that have a member function called `foo`</em></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Statically resolved types are only useable in inline functions.
This is because the compiler has to generate specialisations for each function when the types infered are different.
<code>C++</code> programmers will probably recognise the similarity here with the template mechanism.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In fact, statically resolved types have more in common behaviourally with templates than the standard generic type parameters.
The example given at <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/generics/statically-resolved-type-parameters">MSDN is complicated</a> felt like playing Doom with a controller, so I&#8217;ve concocted a simpler example here.</p>
</div>
<div class="paragraph">
<p>We define 3 types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">type T =
    | TCons
    static member identity x = x

type U =
    | UCons
    static member identity x = x

type W =
    | WCons

let inline foo&lt; ^a when ^a : (static member identity : ^a -&gt; ^a) &gt; (x : ^a) =
    T.identity x</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The space between <code>&lt;</code> and  <code>^a</code> in the type parameter of <code>foo</code> is important.
It won&#8217;t compile without the space.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Two of them have a member <code>identity</code> that does nothing, i.e. it returns its argument unchanged.
The function <code>foo</code> takes a parameter of type <code>^a</code> which is constrained.
The constraint itself, that is starting to look a lot like line noise, says the type <code>^a</code> should have a member <code>identity</code> that takes a parameter that is the same as itself, <code>^a</code>, and returns a value of type <code>^a</code>.
If a type is passed to <code>foo</code> that does not satisfy that constraint the compiler will complain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let x = TCons
let y = UCons
let z = WCons

foo x // Ok
foo y // Ok
foo z // Not ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>You get the error</p>
</div>
<div class="listingblock">
<div class="content">
<pre>error FS0001: The type 'W' does not support the operator 'identity'</pre>
</div>
</div>
<div class="paragraph">
<p>because <code>W</code> does not have a member <code>identity</code> that satisfies the contraint on <code>foo</code>.</p>
</div>
<div class="paragraph">
<p>But there&#8217;s still something not quite right here.
I want my function <code>foo</code> to call the <code>identity</code> member function that is of the same type of the value.</p>
</div>
<div class="paragraph">
<p>In other words, instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">T.identity x</code></pre>
</div>
</div>
<div class="paragraph">
<p>I want:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">^a.identity</code></pre>
</div>
</div>
<div class="paragraph">
<p>Except this doesn&#8217;t compile.
The good news is that there is a way to do this.
The bad news is that the syntax is awkward.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">let inline foo&lt; ^a when ^a : (static member identity : ^a -&gt; ^a) &gt; (x : ^a) =
    (^a : (static member identity : ^a -&gt; ^a) x)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that does it.
When <code>identity</code> is applied from <code>foo</code> that will use the member function belonging to the type <code>x</code>.
If we add some <code>printfn</code> expressions to the <code>identity</code> functions then we can trace the execution of <code>identity</code> functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fsharp hljs" data-lang="fsharp">type T =
    | TCons
    static member identity x = printfn "T identity"; x

type U =
    | UCons
    static member identity x = printfn "U identity"; x

type W =
    | WCons

let inline foo&lt; ^a when ^a : (static member identity : ^a -&gt; ^a) &gt; (x : ^a) =
    (^a : (static member identity : ^a -&gt; ^a) x)

let x = TCons
let y = UCons

foo x
foo y</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the output</p>
</div>
<div class="listingblock">
<div class="content">
<pre>T identity
U identity</pre>
</div>
</div>
<div class="paragraph">
<p>Technically this is an example of <em>parametric polymorphism</em>.
We&#8217;re getting polymorphic behaviour, because a different <code>identity</code> function is executed depending on the type of the parameter.
The other type of polymorphism you are familiar with, <em>dynamic polymorphism</em>, presents itself in the context of inheritance in object oriented programming.
In that case the function called is selected at runtime.
In the case of statically resolved type parameters the function is selected at compile time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_replace_objects_with_closures">How to replace objects with closures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Coming from an object oriented programming language you might struggle to see how to maintain state. The trick is to use a closure. Briefly a closure wraps the things it can see, like values, into it&#8217;s environment and carries it around with it. This allows you to maintain state.
For example say you wanted to keep track of the number of times a function is called. In an OO language you&#8217;d create an object and make the function a member. The member function increments a counter each time that member is called.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. It&#8217;s interesting and somewhat scary to think that <code>F#</code> had a model for doing async before <code>Go</code> was born, yet the industry overlooked <code>F#</code> or didn&#8217;t recognise that it had this quality that could have made many programmers jobs writing concurrent systems a lot easier. Why? A hive minded mentality from developers? Nobody gets blamed for using <code>C#</code> or <code>Java</code> for some enterprisey system. Java had a lot of hype in the 2000s, was the people&#8217;s choice and came out of the underdog Sun Microsystems. They were Unix and they had beards, and that meant they must be smart, smarter than Microsoft the bad guy. All those factors combined to make it hard for F# to stand out despite what at the time was a killer feature that no other language had. Now it&#8217;s 2022, most mainstream languages have some support for asynchronous programming, either cleanly or butchered into the language, and Oracle&#8217;s the bad guy, Microsoft ship Linux inside Windows and own Github (two things Linus Torvalds created), and Sun Microsystems doesn&#8217;t exist.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-09-18 22:12:15 +1000
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/languages/fsharp.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>